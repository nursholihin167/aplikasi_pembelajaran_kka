<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMS Kimia - Pendaftaran Berjenjang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #fefce8; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="text-gray-800 h-screen flex flex-col overflow-hidden relative">

    <!-- HALAMAN AUTH (LOGIN & DAFTAR) -->
    <div id="auth-page" class="flex-1 flex items-center justify-center p-4 bg-[#fefce8] overflow-y-auto">
        <div class="bg-white p-8 rounded-3xl shadow-xl w-full max-sm:p-6 max-w-md text-center fade-in border border-yellow-100 my-8">
            <div id="auth-logo" class="w-20 h-20 bg-amber-500 rounded-full mx-auto mb-4 flex items-center justify-center text-white text-3xl shadow-inner border-4 border-white overflow-hidden">
                <img src="https://i.imgur.com/xjrqTvP.jpeg" class="w-full h-full object-cover" alt="Logo">
            </div>
            <h1 id="auth-title" class="text-2xl font-bold text-amber-900">LMS Kimia</h1>
            <p id="auth-subtitle" class="text-xs text-amber-700 mb-6 italic">Selamat Datang di Portal Pembelajaran</p>

            <!-- Form Login -->
            <div id="login-section">
                <form id="login-form" class="space-y-4 text-left">
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-amber-800 uppercase ml-2">Username</label>
                        <input type="text" id="login-username" class="w-full px-4 py-3 rounded-xl border border-yellow-100 bg-amber-50 focus:ring-2 focus:ring-amber-500 outline-none" placeholder="Masukkan username" required>
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-amber-800 uppercase ml-2">Password</label>
                        <input type="password" id="login-password" class="w-full px-4 py-3 rounded-xl border border-yellow-100 bg-amber-50 focus:ring-2 focus:ring-amber-500 outline-none" placeholder="Masukkan password" required>
                    </div>
                    <button type="submit" class="w-full bg-amber-500 text-white font-bold py-3 rounded-xl hover:bg-amber-600 shadow-lg transition">Masuk</button>
                </form>
                <p class="mt-6 text-sm text-gray-500">Belum punya akun? <a href="#" onclick="toggleAuth(false)" class="text-amber-600 font-bold hover:underline">Daftar Siswa</a></p>
            </div>

            <!-- Form Daftar -->
            <div id="register-section" class="hidden">
                <form id="register-form" class="space-y-4 text-left">
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-amber-800 uppercase ml-2">Nama Lengkap</label>
                        <input type="text" id="reg-fullname" class="w-full px-4 py-3 rounded-xl border border-yellow-100 bg-amber-50 focus:ring-2 focus:ring-amber-500 outline-none" placeholder="Nama sesuai absen" required>
                    </div>
                    
                    <!-- Pilihan Tingkat & Kelas Dinamis -->
                    <div class="grid grid-cols-2 gap-3">
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-amber-800 uppercase ml-2">Tingkat</label>
                            <select id="reg-tingkat" onchange="updateKelasOptions()" class="w-full px-4 py-3 rounded-xl border border-yellow-100 bg-amber-50 focus:ring-2 focus:ring-amber-500 outline-none appearance-none" required>
                                <option value="" disabled selected>Pilih...</option>
                                <option value="X">Kelas X</option>
                                <option value="XI">Kelas XI</option>
                                <option value="XII">Kelas XII</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-amber-800 uppercase ml-2">Kelas Spesifik</label>
                            <select id="reg-kelas" class="w-full px-4 py-3 rounded-xl border border-yellow-100 bg-amber-50 focus:ring-2 focus:ring-amber-500 outline-none appearance-none" required disabled>
                                <option value="" disabled selected>Pilih Tingkat...</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-amber-800 uppercase ml-2">No. Absen</label>
                            <select id="reg-absen" class="w-full px-4 py-3 rounded-xl border border-yellow-100 bg-amber-50 focus:ring-2 focus:ring-amber-500 outline-none appearance-none" required>
                                <option value="" disabled selected>Pilih...</option>
                                <!-- Generated by JS -->
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-amber-800 uppercase ml-2">Username</label>
                            <input type="text" id="reg-username" class="w-full px-4 py-3 rounded-xl border border-yellow-100 bg-amber-50 focus:ring-2 focus:ring-amber-500 outline-none" placeholder="Login" required>
                        </div>
                    </div>

                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-amber-800 uppercase ml-2">Password</label>
                        <input type="password" id="reg-password" class="w-full px-4 py-3 rounded-xl border border-yellow-100 bg-amber-50 focus:ring-2 focus:ring-amber-500 outline-none" placeholder="Min. 6 karakter" required>
                    </div>

                    <button type="submit" class="w-full bg-green-600 text-white font-bold py-3 rounded-xl hover:bg-green-700 shadow-lg transition">Buat Akun Siswa</button>
                </form>
                <p class="mt-6 text-sm text-gray-500">Sudah punya akun? <a href="#" onclick="toggleAuth(true)" class="text-amber-600 font-bold hover:underline">Kembali Login</a></p>
            </div>
        </div>
    </div>

    <!-- DASHBOARD UTAMA -->
    <div id="app-dashboard" class="hidden h-full flex flex-col md:flex-row bg-[#fefce8]">
        <aside class="w-full md:w-64 bg-amber-950 text-amber-50 flex flex-col shadow-2xl z-20">
            <div class="p-6 border-b border-amber-900 flex items-center gap-3">
                <div class="w-8 h-8 rounded-full overflow-hidden bg-amber-900 border border-amber-800">
                    <img src="https://i.imgur.com/xjrqTvP.jpeg" class="w-full h-full object-cover">
                </div>
                <span class="font-bold text-lg">LMS Kimia</span>
            </div>
            <nav class="flex-1 p-4 overflow-y-auto no-scrollbar">
                <ul id="main-menu-list" class="space-y-2"></ul>
            </nav>
            <div class="p-4 border-t border-amber-900 text-[10px] text-amber-600 text-center">
                Masuk sebagai: <br><span id="current-user-display" class="font-bold text-amber-400"></span>
            </div>
        </aside>
        <main id="content-area" class="flex-1 overflow-y-auto p-4 md:p-8 no-scrollbar"></main>
    </div>

    <script>
        let currentUser = null;

        const db = {
            users: JSON.parse(localStorage.getItem('lms_users')) || [
                { username: 'guru', password: '123', name: 'Bu Lina', role: 'Guru', tingkat: '-', kelas: '-', absen: '-' }
            ],
            materi: [{ id: 1, judul: 'Struktur Atom', konten: 'Atom adalah unit dasar materi...' }],
            quizzes: JSON.parse(localStorage.getItem('lms_quizzes')) || [],
            jawabanSiswa: JSON.parse(localStorage.getItem('lms_jawaban')) || []
        };

        // Fungsi Dinamis Pilihan Kelas
        function updateKelasOptions() {
            const tingkatSelect = document.getElementById('reg-tingkat');
            const kelasSelect = document.getElementById('reg-kelas');
            const tingkat = tingkatSelect.value;

            kelasSelect.innerHTML = '<option value="" disabled selected>Pilih Kelas...</option>';
            kelasSelect.disabled = false;

            if (tingkat) {
                for (let i = 1; i <= 10; i++) {
                    const opt = document.createElement('option');
                    // Format: X1...X10, XI1...XI10, XII1...XII10
                    const val = `${tingkat}${i}`;
                    opt.value = val;
                    opt.innerText = val;
                    kelasSelect.appendChild(opt);
                }
            }
        }

        // Isi Absen 1-40
        function populateAbsen() {
            const select = document.getElementById('reg-absen');
            for(let i=1; i<=40; i++) {
                const opt = document.createElement('option');
                opt.value = i;
                opt.innerText = i;
                select.appendChild(opt);
            }
        }
        populateAbsen();

        function toggleAuth(isLogin) {
            document.getElementById('login-section').classList.toggle('hidden', !isLogin);
            document.getElementById('register-section').classList.toggle('hidden', isLogin);
            document.getElementById('auth-title').innerText = isLogin ? 'LMS Kimia' : 'Daftar Siswa Baru';
        }

        function saveData() {
            localStorage.setItem('lms_users', JSON.stringify(db.users));
        }

        document.getElementById('register-form').onsubmit = (e) => {
            e.preventDefault();
            const name = document.getElementById('reg-fullname').value;
            const tingkat = document.getElementById('reg-tingkat').value;
            const kelas = document.getElementById('reg-kelas').value;
            const absen = document.getElementById('reg-absen').value;
            const user = document.getElementById('reg-username').value;
            const pass = document.getElementById('reg-password').value;

            if (db.users.find(u => u.username === user)) return alert('Username sudah ada!');

            db.users.push({ name, tingkat, kelas, absen, username: user, password: pass, role: 'Siswa' });
            saveData();
            alert('Berhasil terdaftar! Silakan login.');
            toggleAuth(true);
        };

        document.getElementById('login-form').onsubmit = (e) => {
            e.preventDefault();
            const u = document.getElementById('login-username').value;
            const p = document.getElementById('login-password').value;
            const user = db.users.find(usr => usr.username === u && usr.password === p);

            if (user) {
                currentUser = user;
                document.getElementById('auth-page').classList.add('hidden');
                document.getElementById('app-dashboard').classList.remove('hidden');
                document.getElementById('current-user-display').innerHTML = 
                    `${user.name}<br>${user.role === 'Siswa' ? `Kelas ${user.kelas} (Absen ${user.absen})` : 'Guru'}`;
                renderMenu();
                renderDashboard();
            } else {
                alert('Login gagal!');
            }
        };

        function renderMenu() {
            const list = document.getElementById('main-menu-list');
            let m = `
                <li><button onclick="renderDashboard()" class="w-full text-left p-3 rounded-xl hover:bg-amber-900 flex items-center gap-3 transition"><i class="fas fa-th-large w-5 text-amber-400"></i> Dashboard</button></li>
                <li><button onclick="renderMateri()" class="w-full text-left p-3 rounded-xl hover:bg-amber-900 flex items-center gap-3 transition"><i class="fas fa-book w-5 text-amber-400"></i> Materi</button></li>
            `;
            if(currentUser.role === 'Guru') {
                m += `<li><button class="w-full text-left p-3 rounded-xl text-green-400 italic">Menu Guru Aktif</button></li>`;
            }
            m += `<li><button onclick="location.reload()" class="w-full text-left p-3 rounded-xl hover:bg-red-900 mt-8 flex items-center gap-3 text-red-300 transition"><i class="fas fa-sign-out-alt"></i> Logout</button></li>`;
            list.innerHTML = m;
        }

        function renderDashboard() {
            document.getElementById('content-area').innerHTML = `
                <div class="fade-in">
                    <h2 class="text-2xl font-black text-amber-900">Selamat Datang, ${currentUser.name}!</h2>
                    <p class="text-amber-700 mb-8">${currentUser.role === 'Siswa' ? `Identitas: Kelas ${currentUser.kelas} / Absen ${currentUser.absen}` : 'Panel Admin Guru'}</p>
                    <div class="bg-white p-6 rounded-3xl border border-yellow-200 shadow-sm max-w-sm">
                        <h4 class="text-xs font-bold text-gray-400 uppercase">Tingkat Pendidikan</h4>
                        <p class="text-lg font-bold text-amber-900">Kelas ${currentUser.tingkat || '-'}</p>
                    </div>
                </div>
            `;
        }

        function renderMateri() {
            document.getElementById('content-area').innerHTML = `<h2 class="text-xl font-bold mb-4">Modul Kimia</h2><p class="text-gray-600">Silakan pilih materi di menu atau hubungi guru untuk modul terbaru.</p>`;
        }
    </script>
</body>
</html>
